<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>typing trainer</title>
<style>
:root{--bg:#f4f4f4;--box:#fff;--text:#000;--correct:green;--wrong:red}
body.dark{--bg:#121212;--box:#1e1e1e;--text:#fff}
body{background:var(--bg);color:var(--text);font-family:Arial;text-align:center;padding:30px}
.box{background:var(--box);padding:20px;max-width:900px;margin:auto;border-radius:10px}
#text{max-height:180px;overflow:auto;border:1px solid #aaa;padding:10px}
#text span{padding:2px}
.correct{color:var(--correct)} .wrong{color:var(--wrong)} .current{text-decoration:underline}
textarea{width:100%;height:90px;font-size:16px;margin-top:10px;background:var(--bg);color:var(--text)}
button{margin:5px;padding:8px 14px;font-size:15px}
canvas{background:#111;margin-top:15px;border-radius:8px}
</style>
</head>
<body>

<div class="box">
<h2>typing trainer</h2>

<button onclick="toggleDark()">dark</button>
<button onclick="togglePractice()">practice: <span id="practice">off</span></button>
<button onclick="toggleNoSpace()">no-space: <span id="nospace">off</span></button>

<div id="best">best wpm: 0</div>
<div id="text"></div>
<textarea id="input"></textarea>

<button onclick="restart()">restart</button>
<div id="result"></div>

<canvas id="chart" width="850" height="200"></canvas>
</div>

<script>
const wordsList=["the","and","you","that","this","with","have","for","not","are","was","but","all","can","has","had","will","dog","cat","run","jump","play","fast","slow","good","nice","fun"];
let words=[],fullText="",noSpace=false,practice=false;
let startTime=0;
let bestWpm=+localStorage.getItem("bestWpm")||0;
let history=JSON.parse(localStorage.getItem("wpmHistory")||"[]");

best.innerText="best wpm: "+bestWpm;

function addWords(count=60){
  for(let i=0;i<count;i++){
    words.push(wordsList[Math.floor(Math.random()*wordsList.length)]);
  }
}

function renderText(){
  fullText=noSpace?words.join(""):words.join(" ");
  text.innerHTML="";
  fullText.split("").forEach((c,i)=>{
    const s=document.createElement("span");
    s.innerText=c;
    if(i===0)s.classList.add("current");
    text.appendChild(s);
  });
}

function restart(){
  words=[]; addWords(80); renderText();
  input.value=""; input.focus();
  result.innerText="";
  startTime=Date.now();
}

input.addEventListener("input",()=>{
  const val=input.value;
  const spans=[...text.children];
  spans.forEach(s=>s.className="");

  for(let i=0;i<val.length;i++){
    if(!spans[i])break;
    if(val[i]===fullText[i])spans[i].classList.add("correct");
    else spans[i].classList.add("wrong");
  }
  if(spans[val.length])spans[val.length].classList.add("current");

  if(val.length>fullText.length*0.8){
    addWords(40);
    renderText();
  }

  if(practice){
    const mins=(Date.now()-startTime)/60000;
    const correctChars=[...val].filter((c,i)=>c===fullText[i]).length;
    const wpm=Math.round((correctChars/5)/mins||0);
    result.innerText="live wpm: "+wpm;
  }
});

function endSession(){
  const mins=(Date.now()-startTime)/60000;
  const correctChars=[...input.value].filter((c,i)=>c===fullText[i]).length;
  const wpm=Math.round((correctChars/5)/mins||0);

  history.push(wpm);
  localStorage.setItem("wpmHistory",JSON.stringify(history));

  let diff=bestWpm-wpm;
  if(wpm>bestWpm){
    bestWpm=wpm;
    localStorage.setItem("bestWpm",bestWpm);
    best.innerText="best wpm: "+bestWpm;
    result.innerText="new high score ðŸŽ‰ "+wpm;
  }else{
    result.innerText=`wpm: ${wpm} | ${Math.abs(diff)} wpm away from best`;
  }
  drawChart();
}

function drawChart(){
  const c=document.getElementById("chart");
  const ctx=c.getContext("2d");
  ctx.clearRect(0,0,c.width,c.height);

  ctx.strokeStyle="#0f0";
  ctx.beginPath();
  history.slice(-20).forEach((v,i)=>{
    const x=i*(c.width/20);
    const y=c.height-(v/Math.max(...history,10))*c.height;
    i?ctx.lineTo(x,y):ctx.moveTo(x,y);
  });
  ctx.stroke();
}

function toggleDark(){document.body.classList.toggle("dark")}
function toggleNoSpace(){noSpace=!noSpace;nospace.innerText=noSpace?"on":"off";restart()}
function togglePractice(){practice=!practice;practice.innerText=practice?"on":"off";restart()}

restart();
drawChart();
</script>

</body>
</html>
